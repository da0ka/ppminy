<!doctype html><title>PPM codec x 5</title><style>
*{box-sizing:border-box}
body{background:#212;background:radial-gradient(circle at center center,#848,#212)}
body,html{height:100%;margin:0;padding:0;overflow:hidden}
body,textarea,input,select{color:snow;font-family:"MS Gothic",monospace}
p{margin:0}
input,select,.tofile{background:#848;border:1px solid #c6c;border-radius:4px}
input,select,label{cursor:pointer;text-shadow:1px 1px #000;white-space:nowrap}
textarea{background:transparent;overflow:auto;resize:none}
.t2t{height:100%;display:flex;flex-direction:column}
.t2t textarea{height:50%}
textarea,#res{width:100%}
input[type=file]{display:none}
#oform{padding:0 .5em;line-height:1.5em;overflow:auto;position:absolute;top:1.2em;bottom:0}

/* drop area */
@keyframes rotate{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
ol{border:1px dashed #caf;overflow:auto;background:rgba(48,32,48,.75);margin:0;position:absolute;top:2.8em;bottom:0;left:0;right:0}
ol:empty:before{content:"Drop files here";display:block;text-align:center;position:relative;top:45%}
ol li input{border:0}
ol li{padding:.125rem .25rem;position:relative}
ol li:not(.done) a~*{display:none}
ol li:not(.done):before{animation:rotate 1.25s linear infinite;content:" ";display:block;height:100%;width:1.5rem;position:absolute;left:-1rem;top:0;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzI3QUFFMSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNNDYgNGg4djI0aC04eiIvPjxwYXRoIG9wYWNpdHk9Ii45MSIgZD0iTTIzIDExLjczMjA2bDYuOTI4Mi00IDEyIDIwLjc4NDYtNi45MjgyIDR6Ii8+PHBhdGggb3BhY2l0eT0iLjgzIiBkPSJNNy43MzIwNSAyOS45MjgybDQtNi45MjgyIDIwLjc4NDYxIDEyLTQgNi45MjgyeiIvPjxwYXRoIG9wYWNpdHk9Ii43NSIgZD0iTTQgNTR2LThoMjR2OHoiLz48cGF0aCBvcGFjaXR5PSIuNjYiIGQ9Ik0xMS43MzIwNSA3Ni45MjgybC00LTYuOTI4MiAyMC43ODQ2LTEyIDQgNi45MjgyeiIvPjxwYXRoIG9wYWNpdHk9Ii41OCIgZD0iTTI5LjkyODIgOTIuNTE2NjZsLTYuOTI4Mi00IDEyLTIwLjc4NDYxIDYuOTI4MiA0eiIvPjxwYXRoIG9wYWNpdHk9Ii41IiBkPSJNNTQgOTZoLThWNzJoOHoiLz48cGF0aCBvcGFjaXR5PSIuNDEiIGQ9Ik03Ni45MjgyIDg4LjUxNjY2bC02LjkyODIgNC0xMi0yMC43ODQ2MSA2LjkyODItNHoiLz48cGF0aCBvcGFjaXR5PSIuMzMiIGQ9Ik05Mi41MTY2NiA3MGwtNCA2LjkyODItMjAuNzg0Ni0xMiA0LTYuOTI4MnoiLz48cGF0aCBvcGFjaXR5PSIuMjUiIGQ9Ik05NiA0NnY4SDcydi04eiIvPjxwYXRoIG9wYWNpdHk9Ii4xNiIgZD0iTTg4LjUxNjY2IDIzbDQgNi45MjgyLTIwLjc4NDYgMTItNC02LjkyODJ6Ii8+PHBhdGggb3BhY2l0eT0iLjA4IiBkPSJNNzAgNy43MzIwNWw2LjkyODIgNC0xMiAyMC43ODQ2MS02LjkyODItNHoiLz48L2c+PC9zdmc+)center center/1rem 1rem no-repeat}
ol li.done:before{content:" ";display:block;height:100%;width:1.5rem;position:absolute;left:-1rem;top:0;background:url('data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2250%22%20height%3D%2243%22%20viewBox%3D%220%200%2050%2043%22%3E%3Cpath%20fill%3D%22%2392b0b3%22%20d%3D%22M48.4%2026.5c-.9%200-1.7.7-1.7%201.7v11.6h-43.3v-11.6c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7%201.7v13.2c0%20.9.7%201.7%201.7%201.7h46.7c.9%200%201.7-.7%201.7-1.7v-13.2c0-1-.7-1.7-1.7-1.7zm-24.5%206.1c.3.3.8.5%201.2.5.4%200%20.9-.2%201.2-.5l10-11.6c.7-.7.7-1.7%200-2.4s-1.7-.7-2.4%200l-7.1%208.3v-25.3c0-.9-.7-1.7-1.7-1.7s-1.7.7-1.7%201.7v25.3l-7.1-8.3c-.7-.7-1.7-.7-2.4%200s-.7%201.7%200%202.4l10%2011.6z%22/%3E%3C/svg%3E')center center/1rem 1rem no-repeat}
ol li a{color:snow}
ol li a:link{color:#ccf;font-weight:700}
ol li a:hover{color:#ffc}
.dover{background:#424}
.dpass{background:rgba(48,32,48,.75)}

/* modal main */
.modalson{
	background:rgba(64,32,64,.75);
	overflow:auto;
	position:fixed;
	transition:all .2s;
	z-index:999
}
.modal>input{display:none}

.modalson>label[for]{
	border-style:solid;
	border-width:1px 0;
	border-color:#eae #212 #212 #434;
	display:block;width:100%;
	text-align:center
}
.modalson>label:hover{
	background:rgba(96,48,96,.75);color:#ff0
}
.modal .closer{
	 left:0;right:0;top:0;bottom:0;
	 position:fixed;
	 z-index:-1
}
.modal input:checked~ .closer{
	background:rgba(0,0,0,.5);z-index:998
}
/* modal size */
.m-up{top:100%;left:0;right:0;bottom:1.25em}
.m-l2r{top:1px;width:100%;right:100%;bottom:1.25em}

/* modal switch */
.modal input:checked~.m-up{top:52%;bottom:1.3em}
.modal input:checked~.m-l2r{right:0}

/* side menu */
.menu{
	background-color:#424;
	background-color:rgba(64,32,64,.75);
	box-shadow:1px 1px 2px 2px rgba(0,0,0,.5);
	border-radius:0 0 0 10px;
	font-size:1.25em;
	margin:0;
	padding:0 8px 0 30px;
	width:0;
	height:24px;
	-moz-transition:all .25s;
	-webkit-transition:all .25s;
	-o-transition:all .25s;
	-ms-transition:all .25s;
	transition:all .25s;
	overflow:hidden;
	line-height:1.25em;
	position:fixed;
	top:0;
	right:-20px;
	z-index:1000
}
.menu:before{
	content:"\2261";
	border-right:2px solid #212;
	display:block;
	background-color:#a6a;
	background-color:rgba(160,96,160,.75);
	font-weight:700;
	position:absolute;
	left:0;
	width:18px;
	height:100%;
	text-align:center
}
.menu:hover{overflow:auto;right:0;height:auto;width:auto}
</style>
<form class=t2t>
	<textarea id=it></textarea>
	<p align=center>
		code<select id=ip><option>EU16<option>EU16a<option>SJU<option>UTF8</select>
		base<select id=op><option>64<option>85<option>91<option>122<option>32768<option>10d<option>16h</select>
		<input type=button value="vary↓" id=en>
		<input type=button value="undo↑" id=de>
		<input type=reset value=reset></p>
	<textarea id=ot></textarea>
	<p><input type=button id=res></p>
</form>
<div class=modal>
	<input type=checkbox id=spec>
	<div class="modalson m-l2r">
		<label for=spec>Spec</label>includes 5 ppm compressors(select by <b>type</b>). compression ratio is usually better than gzip,but much slower.<p><b>simple</b> is fastest, <b>II2+SEE</b> is strongest.<p><b>order</b> means context order that affect compression ratio and speed.
	</div>
</div>
<form class=modal id=uform>
	<input type=checkbox id=uload>
	<div class="modalson m-l2r">
		<label for=uload>Process Files</label><p style="text-align:center">
		<label class=tofile id=kill>kill</label>
		<label class=tofile><input type=file id=upfile>LOAD</label>
		<label class=tofile id=save>Save</label>
		<b class=tofile><label for=opts>&#160;&#8801;&#160;</label></b>
		<label><input type=checkbox id=fdec>Decode</label>
		<ol id=flist></ol>
	</div>
</form>
<div class=modal>
	<input type=checkbox id=opts>
	<div class="modalson m-up" style="overflow:hidden"><label for=opts>options</label>
		<form id=oform>
		type<select id=type><option>simple<option>II<option>II2<option>II2+SEE<option>II2+SEE2</select>
		order<input size=2 value=3 id=order>+2
		</form>
	</div>
</div>
<dl class=menu>
<dt><label for=spec>Spec</label>
<dt><label for=opts>Options</label>
<dt><label for=uload>Files</label>
</dl><script>
//////////////// PPM ////////////////
const PPMe=[//encoders
//simple
async function(A,mo,done,rate){
	for(var L=0,R=1<<24,B,N=0,a=1,b=A[0],c,d,f,i=256,l,o=-1,r,t,z=A.length,x=z>>18?65535:z>>16?16383:2047,fn=b=>setTimeout(c=>b(rate(a,z))),v=[],C=v,E=[],O=[];i--;)d=v[i]={s:i,c:0};//reset order0
	for(mo&=15;d=d.l=[],d.s=v,v=d,i++<mo;)d=v[0]={s:0,c:0};
	for(x&=mo<4?-1:mo<9?8191:4095;;){
		for(d=i=t=0;c=C[i++];)
			if(!E[c.s])f=1+c.c,c.s===b&&(l=f,r=t,d=c),t+=f;//scan model
		f=--i>>8||i;
		if(!d)l=f,r=t;
		R=R/(t+f)>>>0;L+=R*r;//encode
		for(R*=l;R<1e7;R*=256,L=L<<8>>>0)
			if(255>L>>>24)
				for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
			else++N;
		if(c=d){//hit
			if(255<(c.c+=2))for(c of C)c.c>>=1;//rescale
			if(i=C==v)C=v=d.l;
			else{//update
				for(;C!=v;v=v.s)E[i++]=v[v.length]={s:b,c:0};
				for(d.l?C=v=d.l:(d=d.l=[],d.s=v,v=d);--i;d=d.l=[],d.s=v,v=d)d=E[i];
				E[i].l=v;E.length=0
			}b=A[a++],x&a||await new Promise(fn)
		}else{//fail
			for(c of C)E[c.s]=1;C=C.s;
			if(!C){//done
				for(O[0]=mo,i=5;i--;L=L<<8>>>0)
					if(255>L>>>24)
						for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
					else++N;
				for(;!O[o-1];)--o;
				done(O,z,O.length=o);return O
			}
		}
	}
},
//II
async function(A,mo,done,rate){
	for(var L=0,R=1<<24,B,N=0,a=1,b=A[0],c,d,f,l,o=-1,r,t,z=A.length,x=z>>18?65535:z>>16?16383:2047,fn=b=>setTimeout(c=>b(rate(a,z))),v=[],C=v,E=[],O=[],i=256;i--;)d=v[i]={s:i,c:0};
	for(mo&=31;d=d.l=[],d.s=v,v=d,i++<mo;)d=v[0]={s:0,c:0};
	for(x&=mo<5?-1:mo<15?8191:4095;;){
		d=t=0,i=C.length;
		for(c of C)if(!E[c.s])f=1+c.c,c.s===b&&(l=f,r=t,d=c),t+=f;
		f=i>>8||i;if(!d)l=f,r=t;
		R=R/(C.c=t+f)>>>0;L+=R*r;
		for(R*=l;R<1e7;R*=256,L=L<<8>>>0)
			if(255>L>>>24)
				for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
			else++N;
		if(d){
			if(255<(d.c+=2))for(c of C)c.c>>>=1;//rescale
			if(c=C==v)C=v=d.l;
			else{
				for(i=C.c;C!=v;v=v.s)
					t=0|v.c,r=2*l*(6+t),t+=i,r=r>6*t?2+r/t/2:r/t/1.6,
					E[c++]=v[v.length]={s:b,c:r>6?6:r|0};
				for(d.l?C=v=d.l:(d=d.l=[],d.s=v,v=d);--c;d=d.l=[],d.s=v,v=d)d=E[c];
				E[c].l=v;E=[]
			}b=A[a++],x&a||await new Promise(fn)
		}else{
			for(c of C)E[c.s]=1;
			if(!(C=C.s)){
				for(O[0]=mo,i=5;i--;L=L<<8>>>0)
					if(255>L>>>24)
						for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
					else++N;
				for(;!O[o-1];)--o;
				done(O,z,O.length=o);return O
			}
		}
	}
},
//II2
async function(A,mo,done,rate){
	for(var L=0,R=1<<24,B,N=0,a=1,b=A[0],c,d,f,l,o=-1,r,t,z=A.length,x=z>>18?65535:z>>16?16383:2047,fn=b=>setTimeout(c=>b(rate(a,z))),v=[],C=v,E=[],O=[],i=v.c=256;i--;)d=v[i]={s:i,c:0};
	for(mo&=31;d=d.l=[],d.c=0,d.s=v,v=d,i++<mo;)d=v[0]={s:0,c:0};
	for(x&=mo<5?-1:mo<15?8191:4095;C;){
		i=C.length;d=t=0;
		for(c of C)if(!E[c.s])f=1+c.c,c.s===b&&(l=f,r=t,d=c),t+=f;
		f=i>>8||i;if(!d)l=f,r=t;
		R=R/(t+f)>>>0;L+=R*r;
		for(R*=l;R<1e7;R*=256,L=L<<8>>>0)
			if(255>L>>>24)
				for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
			else++N;
		if(d){C.c+=2;
			if(255<(d.c+=2)){r=t=0;//rescale
				for(c of C)if(t+=f=c.c>>>=1,f&&C.s)C[r++]=c;
				C.c=t+=C.length=r||i}
			if(c=C==v)C=v=d.l;
			else{
				for(i+=C.c;C!=v;v=v.s)
					f=v.length,t=v.c+f,r=2*l*(6+t),t+=i,r=r>6*t?2+r/t/2:r/t/1.6,
					v.c+=r=r<6?r:6,E[c++]=v[f]={s:b,c:r|0};
				for(d.l?C=v=d.l:(d=d.l=[],d.c=0,d.s=v,v=d);--c;d=d.l=[],d.c=0,d.s=v,v=d)d=E[c];
				E[c].l=v;E=[]
			}b=A[a++],x&a||await new Promise(fn)
		}else{for(c of C)E[c.s]=1;C=C.s}
	}
	for(O[0]=mo,i=5;i--;L=L<<8>>>0)
		if(255>L>>>24)
			for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
		else++N;
	for(;!O[o-1];)--o;
	done(O,z,O.length=o);return O
},
//II2+SEE
async function(A,mo,done,rate){
	for(var L=0,R=1<<24,B,N=0,a=1,b=A[0],c,d,e,f,l,o,r,t,z=A.length,x=z>>18?65535:z>>16?16383:2047,fn=b=>setTimeout(c=>b(rate(a,z))),v=[],C=v,E=[],T=[],M=[],O=[],i=v.c=256;i--;M[i]=Math.sqrt(i))for(o=16,d=v[i]={s:i,c:0};o--;)T[i<<4|o]=0|(i+1<<14)/(i+2);
	for(mo&=63;d=d.l=[],d.c=0,d.s=v,v=d,i++<mo;)d=v[0]={s:0,c:0};
	for(x&=mo<5?-1:mo<15?8191:4095;;){d=0,i=C.length;
		if(i>1){t=0;
			for(c of C)if(!E[c.s])f=1+c.c,c.s===b&&(l=f,r=t,d=c),t+=f;
			f=i>>8||i;if(!d)l=f,r=t;R=R/(t+f)>>>0;
		}else{// binary context
			c=C[0];f=T[r=c.c<<4|M[C.s.length-1]];
			l=16384-f;R>>>=14;
			if(c.s!==b)T[r]-=f>>6,r=f;
			else T[r]+=l>>6,r=0,l=f,d=c
		}
		L+=R*r;
		for(R*=l;R<1e7;R*=256,L=L<<8>>>0)
			if(255>L>>>24)
				for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
			else++N;
		if(d){C.c+=2;
			if(255<(d.c+=2)){r=t=0;
				for(c of C)if(t+=f=c.c>>>=1,f&&C.s)C[r++]=c;
				C.c=t+=C.length=r||i}
			if(c=C==v)C=v=d.l;
			else{
				for(i+=C.c;C!=v;v=v.s)
					r=v.length,t=v.c+r,e=l*2*(6+t),t+=i,e=e>6*t?2+e/t/2:e/t/1.6,v.c+=e=e>6?6:e,
					E[c++]=v[r]={s:b,c:e|0};
				for(d.l?C=v=d.l:(d=d.l=[],d.c=0,d.s=v,v=d);--c;d=d.l=[],d.c=0,d.s=v,v=d)d=E[c];
				E[c].l=v;E=[]
			}b=A[a++],x&a||await new Promise(fn)
		}else{
			for(c of C)E[c.s]=1;
			do if(!(C=C.s)){
				for(O[0]=mo,i=5;i--;L=L<<8>>>0)
					if(255>L>>>24)
						for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
					else++N;
				for(;!O[o-1];)--o;
				done(O,z,O.length=o);return O
			}while(i===C.length)
		}
	}
},
//II2+SEE2
async function(A,mo,done,rate){
	for(var L=0,R=1<<24,B,N=0,a=1,b=A[0],c,d,e,f,h,k,l,o,r,t,z=A.length,x=z>>18?65535:z>>16?16383:2047,fn=b=>setTimeout(c=>b(rate(a,z))),v=[],C=v,E=[],S=[],T=[],M=[],O=[],i=v.c=256;i--;S[i]={s:8*(i>>4)+5<<3,c:7,l:3},M[i]=Math.sqrt(i))for(o=16,d=v[i]={s:i,c:0};o--;)T[i<<4|o]=0|(i+1<<14)/(i+2);
	for(mo&=63;d=d.l=[],d.c=0,d.s=v,v=d,i++<mo;)d=v[0]={s:0,c:0};
	for(x&=mo<5?-1:mo<15?8191:4095;;){
		d=0,i=C.length;
		if(1<i){
			e=t=0;for(c of C)if(!E[c.s])f=1+c.c,c.s===b&&(l=f,r=t,d=c),t+=f,e++;
			f=i>>8||i;//P(esc)
			if(1<f&&E.length){//P'(esc)
				h=S[M[e-1]<<4|k<<3|(C.c>i*8)<<2|(i>e*2)<<1|(C.s.length+h>i*2)],
				h.s-=f=h.s>>h.l,f+=!f;
				if(k=!d)h.s+=t+f;
				else h.l>6||--h.c||(h.s*=2,h.c=3<<h.l++)
			}
			if(!d)l=f,r=t;t+=f
		}else{//P"(esc)
			c=C[0];f=T[r=c.c<<4|M[C.s.length-1]];t=16384,l=t-f;
			if(c.s!==b)T[r]-=f>>6,r=f;
			else T[r]+=l>>6,r=0,l=f,d=c
		}
		R=R/t>>>0;L+=R*r;
		for(R*=l;R<1e7;R*=256,L=L<<8>>>0)
			if(255>L>>>24)
				for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
			else++N;
		if(d){C.c+=2;
			if(255<(d.c+=2)){r=t=0;
				for(c of C)if(t+=f=c.c>>>=1,f&&C.s)C[r++]=c;
				C.c=t+=C.length=r||i}
			if(c=C==v)C=v=d.l;
			else{
				for(i+=C.c;C!=v;v=v.s)
					r=v.length,t=v.c+r,e=l*2*(6+t),t+=i,e=e>6*t?2+e/t/2:e/t/1.6,v.c+=e=e>6?6:e,
					E[c++]=v[r]={s:b,c:e|0};
				for(d.l?C=v=d.l:(d=d.l=[],d.c=0,d.s=v,v=d);--c;d=d.l=[],d.c=0,d.s=v,v=d)d=E[c];
				E[c].l=v;E=[]
			}b=A[a++],x&a||await new Promise(fn)
		}else{
			for(c of C)E[c.s]=1;
			for(h=i;(C=C.s)&&i==C.length;);
			if(!C){
				for(O[0]=mo,i=5;i--;L=L<<8>>>0)
					if(255>L>>>24)
						for(f=L>0xffffffff,O[o++]=255&f--+B,B=L>>>24;N;N--)O[o++]=255&f;
					else++N;
				for(;!O[o-1];)--o;
				done(O,z,O.length=o);return O
			}
		}
	}
}],
PPMd=[// decoders
//simple
async(k,done,rate)=>{for(var o=1,n=1,r=256,e=k[0],f,i,s,t=0,c=[],a=c,l=[],u=[],b,z=k.length,w=b=>setTimeout(c=>b(rate(n,z)));r;)b=c[--r]={f:0,o:r};for(;b=b.r=[],b.o=c,c=b,~e--;)b=c[0]={f:0,o:r};for(;a;o*=i){s=0;for(e of a)if(!l[e.o])s+=i=1+e.f;for(i=a.length;o<1e7;o*=256)f=(f<<8|k[n++])>>>0;i=i>>>8||i;o=o/(s+i)>>>0;b=f/o>>>0;if(b<s){s=0;for(e of a)if(!l[e.o]&&b<(s+=i=1+e.f))break;s-=i;u[t++]=r=e.o;b=e;if((e.f+=2)>>>8)for(e of a)e.f>>>=1;if(e=a==c)a=c=b.r;else{for(;a!=c;c=c.o)l[e++]=c[c.length]={f:0,o:r};for(c=b.r?a=b.r:(b=b.r=[],b.o=c,c=b);--e;b=b.r=[],b.o=c,c=b)b=l[e];l[e].r=c;l=[]}32767&t||await new Promise(w)}else{for(e of a)l[e.o]=1;a=a.o}f-=o*s}done(u,z,t);return u},
//II
async(k,done,rate)=>{for(var o=1,n=1,r=256,e=k[0],f,g,h,i,s,t=0,c=[],l=[],u=[],a=c,b,z=k.length,w=b=>setTimeout(c=>b(rate(n,z)));r;)b=c[--r]={l:r,f:0};for(;b=b.r=[],b.l=c,c=b,~e--;)b=c[0]={l:r,f:0};for(;a;o*=i){s=0;for(e of a)if(!l[e.l])s+=i=1+e.f;for(i=a.length;o<1e7;o*=256)g=(g<<8|k[n++])>>>0;i=i>>>8||i;o=o/(a.f=s+i)>>>0;b=g/o>>>0;if(b<s){s=0;for(e of a)if(!l[e.l]&&b<(s+=i=1+e.f))break;s-=i;u[t++]=r=e.l;b=e;if((e.f+=2)>>>8)for(e of a)e.f>>>=1;if(e=a==c)a=c=b.r;else{for(;a!=c;c=c.l)h=c.f|0,f=i*2*(6+h),h+=a.f,f=f>6*h?2+f/h/2:f/h/1.6,l[e++]=c[c.length]={l:r,f:f>6?6:f|0};for(c=b.r?a=b.r:(b=b.r=[],b.l=c,c=b);--e;b=b.r=[],b.l=c,c=b)b=l[e];l[e].r=c;l=[]}32767&t||await new Promise(w)}else{for(e of a)l[e.l]=1;a=a.l}g-=o*s}done(u,z,t);return u},
//II2
async(k,done,rate)=>{for(var o=1,n=1,d,e=k[0],f,g,h,i,s,t=0,v,c=[],l=[],u=[],a=c,b,r=a.f=256,z=k.length,w=b=>setTimeout(c=>b(rate(n,z)));r;)b=c[--r]={o:r,f:0};for(;b=b.r=[],b.o=c,b.f=0,c=b,~e--;)b=c[0]={o:r,f:0};for(;a;o*=i){s=0;for(e of a)if(!l[e.o])s+=i=1+e.f;for(v=a.length;o<1e7;o*=256)f=(f<<8|k[n++])>>>0;i=v>>>8||v;o=o/(s+i)>>>0;b=f/o>>>0;if(b<s){s=0;for(e of a)if(!l[e.o]&&b<(s+=i=1+e.f))break;s-=i;u[t++]=r=e.o;b=e;a.f+=2;if((e.f+=2)>>>8){d=h=0;for(e of a)if(h+=g=e.f>>>=1,g&&a.o)a[d++]=e;a.f=h+=a.length=d||v}if(e=a==c)a=c=b.r;else{for(v+=a.f;a!=c;c=c.o)h=c.f+c.length,g=2*i*(6+h),h+=v,g=g>6*h?2+g/h/2:g/h/1.6,c.f+=g=g>6?6:g,l[e++]=c[c.length]={o:r,f:g|0};for(c=b.r?a=b.r:(b=b.r=[],b.o=c,b.f=0,c=b);--e;b=b.r=[],b.o=c,b.f=0,c=b)b=l[e];l[e].r=c;l=[]}32767&t||await new Promise(w)}else{for(e of a)l[e.o]=1;a=a.o}f-=o*s}done(u,z,t);return u},
//II2+SEE
async(M,done,rate)=>{for(var k,n=1,a=1,c=1+M[0],d,e,f,i,r,t,o,v=[],g=v,h=[],q=[],l=[],b=v.e=256,z=M.length,w=b=>setTimeout(c=>b(rate(a,z)));b;)for(o=16,v[--b]={s:b,e:0};o;)q[b<<4|--o]=0|(b+1<<14)/(b+2);for(;d=v[0],d=d.l=[],d.e=0,d.s=v,v=d,c--;)v[b]={s:b,e:0};for(;;n*=f){for(i=g.length;n<1e7;n*=256)k=(k<<8|M[a++])>>>0;if(i>1){t=0;for(c of g)if(!h[c.s])t+=1+c.e;f=i>>>8||i;n=n/(t+f)>>>0;r=k/n>>>0;if(c=r<t){t=0;for(c of g)if(!h[c.s]&&r<(t+=f=1+c.e))break;t-=f}}else{c=g[0],f=q[b=c.e<<4|Math.sqrt(g.s.length-1)];n>>>=14,e=16384-f;if(k/n>>>0<f){t=0,q[b]+=e>>>6}else{c=0,q[b]-=f>>>6,t=f,f=e}}k-=n*t;if(c){l[o++]=b=c.s,d=c;g.e+=2;if((c.e+=2)>>>8){r=t=0;for(c of g)if(t+=e=c.e>>>=1,e&&g.s)g[r++]=c;g.e=t+=g.length=r||i}if(c=g==v){g=v=d.l}else{for(i+=g.e;g!=v;v=v.s)t=v.e+v.length,e=f*2*(6+t),t+=i,e=e>6*t?2+e/t/2:e/t/1.6,v.e+=e=e>6?6:e,h[c++]=v[v.length]={s:b,e:0|e};for(v=d.l?g=d.l:(d=d.l=[],d.e=0,d.s=v,v=d);--c;d=d.l=[],d.e=0,d.s=v,v=d)d=h[c];h[c].l=v;h=[]}32767&o||await new Promise(w)}else{for(c of g)h[c.s]=1;for(;i==g.length;)if(!(g=g.s))return done(l,z,o),l}}},
//II2+SEE2
async(s,done,rate)=>{for(var q,j=1,a=1,c=s[0],d,e,f,h,i,k,r,t,o=0,v=[],g=v,n=[],m=[],p=[],M=[],u=[],b=v.c=256,z=s.length,w=b=>setTimeout(c=>b(rate(a,z)));b--;m[b]={s:8*(b>>>4)+5<<3,c:7,l:3},M[b]=Math.sqrt(b))for(o=16,d=v[b]={s:b,c:0};o;)p[b<<4|--o]=0|(b+1<<14)/(b+2);for(;d=d.l=[],d.c=0,d.s=v,v=d,b++<c;)d=v[0]={s:0,c:0};for(;;j*=f){for(i=g.length;j<1e7;j*=256)q=(q<<8|s[a++])>>>0;if(b=1<i){e=t=0;for(c of g)if(!n[c.s])t+=1+c.c,e++;f=i>>>8||i;if(b=1<f&&n.length)h=m[M[e-1]<<4|k<<3|(g.c>8*i)<<2|(i>2*e)<<1|g.s.length+h>2*i],h.s-=f=h.s>>>h.l,f+=!f;j=j/(t+f)>>>0,r=q/j>>>0;if(c=r<t){t=0;for(c of g)if(!n[c.s]&&r<(t+=f=1+c.c))break;t-=f}}else{c=g[0],f=p[r=c.c<<4|M[g.s.length-1]];j>>>=14,e=16384-f;if(q/j>>>0<f){t=0,p[r]+=e>>>6}else{c=0,p[r]-=f>>>6,t=f,f=e}}q-=j*t;if(c){if(b)k=0,h.l>6||--h.c||(h.s*=2,h.c=3<<h.l++);u[o++]=b=c.s;d=c;g.c+=2;if((c.c+=2)>>>8){r=t=0;for(c of g)if(t+=e=c.c>>>=1,e&&g.s)g[r++]=c;g.c=t+=g.length=r||i}if(c=g==v){g=v=d.l}else{for(i+=g.c;g!=v;v=v.s)t=v.c+v.length,e=2*f*(6+t),t+=i,e=e>6*t?2+e/t/2:e/t/1.6,v.c+=e=e>6?6:e,n[c++]=v[v.length]={s:b,c:0|e};for(v=d.l?g=d.l:(d=d.l=[],d.c=0,d.s=v,v=d);--c;d=d.l=[],d.c=0,d.s=v,v=d)d=n[c];n[c].l=v;n=[]}32767&o||await new Promise(w)}else{if(b)k=1,h.s+=t+f;for(c of g)n[c.s]=1;for(h=i;i==g.length;)if(!(g=g.s))return done(u,z,o),u}}}
],
PPMd2=[// decoders2(without Promise)
//simple
k=>{for(var o=1,n=1,r=256,e=k[0],f,i,s,t=0,c=[],a=c,l=[],u=[],b;r;)b=c[--r]={f:0,o:r};for(;b=b.r=[],b.o=c,c=b,~e--;)b=c[0]={f:0,o:r};for(;a;o*=i){s=0;for(e of a)if(!l[e.o])s+=i=1+e.f;for(i=a.length;o<1e7;o*=256)f=(f<<8|k[n++])>>>0;i=i>>>8||i;o=o/(s+i)>>>0;b=f/o>>>0;if(b<s){s=0;for(e of a)if(!l[e.o]&&b<(s+=i=1+e.f))break;s-=i;u[t++]=r=e.o;b=e;if((e.f+=2)>>>8)for(e of a)e.f>>>=1;if(e=a==c)a=c=b.r;else{for(;a!=c;c=c.o)l[e++]=c[c.length]={f:0,o:r};for(c=b.r?a=b.r:(b=b.r=[],b.o=c,c=b);--e;b=b.r=[],b.o=c,c=b)b=l[e];l[e].r=c}l=[]}else{for(e of a)l[e.o]=1;a=a.o}f-=o*s}return u},
//II
k=>{for(var o=1,n=1,r=256,e=k[0],f,g,h,i,s,t=0,c=[],l=[],u=[],a=c,b;r;)b=c[--r]={l:r,f:0};for(;b=b.r=[],b.l=c,c=b,~e--;)b=c[0]={l:r,f:0};for(;a;o*=i){s=0;for(e of a)if(!l[e.l])s+=i=1+e.f;for(i=a.length;o<1e7;o*=256)g=(g<<8|k[n++])>>>0;i=i>>>8||i;o=o/(a.f=s+i)>>>0;b=g/o>>>0;if(b<s){s=0;for(e of a)if(!l[e.l]&&b<(s+=i=1+e.f))break;s-=i;u[t++]=r=e.l;b=e;if((e.f+=2)>>>8)for(e of a)e.f>>>=1;if(e=a==c)a=c=b.r;else{for(;a!=c;c=c.l)h=c.f|0,f=i*2*(6+h),h+=a.f,f=f>6*h?2+f/h/2:f/h/1.6,l[e++]=c[c.length]={l:r,f:f>6?6:f|0};for(c=b.r?a=b.r:(b=b.r=[],b.l=c,c=b);--e;b=b.r=[],b.l=c,c=b)b=l[e];l[e].r=c}l=[]}else{for(e of a)l[e.l]=1;a=a.l}g-=o*s}return u},
//II2
k=>{for(var o=1,n=1,d,e=k[0],f,g,h,i,s,t=0,v,c=[],l=[],u=[],a=c,b,r=a.f=256;r;)b=c[--r]={o:r,f:0};for(;b=b.r=[],b.o=c,b.f=0,c=b,~e--;)b=c[0]={o:r,f:0};for(;a;o*=i){s=0;for(e of a)if(!l[e.o])s+=i=1+e.f;for(v=a.length;o<1e7;o*=256)f=(f<<8|k[n++])>>>0;i=v>>>8||v;o=o/(s+i)>>>0;b=f/o>>>0;if(b<s){s=0;for(e of a)if(!l[e.o]&&b<(s+=i=1+e.f))break;s-=i;u[t++]=r=e.o;b=e;a.f+=2;if((e.f+=2)>>>8){d=h=0;for(e of a)if(h+=g=e.f>>>=1,g&&a.o)a[d++]=e;a.f=h+=a.length=d||v}if(e=a==c)a=c=b.r;else{for(v+=a.f;a!=c;c=c.o)h=c.f+c.length,g=2*i*(6+h),h+=v,g=g>6*h?2+g/h/2:g/h/1.6,c.f+=g=g>6?6:g,l[e++]=c[c.length]={o:r,f:g|0};for(c=b.r?a=b.r:(b=b.r=[],b.o=c,b.f=0,c=b);--e;b=b.r=[],b.o=c,b.f=0,c=b)b=l[e];l[e].r=c}l=[]}else{for(e of a)l[e.o]=1;a=a.o}f-=o*s}return u},
//II2+SEE
M=>{for(var k,n=1,a=1,c=1+M[0],d,e,f,i,r,t,o,v=[],g=v,h=[],q=[],l=[],b=v.e=256;b;)for(o=16,v[--b]={s:b,e:0};o;)q[b<<4|--o]=0|(b+1<<14)/(b+2);for(;d=v[0],d=d.l=[],d.e=0,d.s=v,v=d,c--;)v[b]={s:b,e:0};for(;;n*=f){for(i=g.length;n<1e7;n*=256)k=(k<<8|M[a++])>>>0;if(i>1){t=0;for(c of g)if(!h[c.s])t+=1+c.e;f=i>>>8||i;n=n/(t+f)>>>0;r=k/n>>>0;if(c=r<t){t=0;for(c of g)if(!h[c.s]&&r<(t+=f=1+c.e))break;t-=f}}else{c=g[0],f=q[b=c.e<<4|Math.sqrt(g.s.length-1)];n>>>=14,e=16384-f;if(k/n>>>0<f){t=0,q[b]+=e>>>6}else{c=0,q[b]-=f>>>6,t=f,f=e}}k-=n*t;if(c){l[o++]=b=c.s,d=c;g.e+=2;if((c.e+=2)>>>8){r=t=0;for(c of g)if(t+=e=c.e>>>=1,e&&g.s)g[r++]=c;g.e=t+=g.length=r||i}if(c=g==v){g=v=d.l}else{for(i+=g.e;g!=v;v=v.s)t=v.e+v.length,e=f*2*(6+t),t+=i,e=e>6*t?2+e/t/2:e/t/1.6,v.e+=e=e>6?6:e,h[c++]=v[v.length]={s:b,e:0|e};for(v=d.l?g=d.l:(d=d.l=[],d.e=0,d.s=v,v=d);--c;d=d.l=[],d.e=0,d.s=v,v=d)d=h[c];h[c].l=v}h=[]}else{for(c of g)h[c.s]=1;for(;i==g.length;)if(!(g=g.s))return l}}},
//II2+SEE2
s=>{for(var q,j=1,a=1,c=s[0],d,e,f,h,i,k,r,t,o=0,v=[],g=v,n=[],m=[],p=[],M=[],u=[],b=v.c=256;b--;m[b]={s:8*(b>>>4)+5<<3,c:7,l:3},M[b]=Math.sqrt(b))for(o=16,d=v[b]={s:b,c:0};o;)p[b<<4|--o]=0|(b+1<<14)/(b+2);for(;d=d.l=[],d.c=0,d.s=v,v=d,b++<c;)d=v[0]={s:0,c:0};for(;;j*=f){for(i=g.length;j<1e7;j*=256)q=(q<<8|s[a++])>>>0;if(b=1<i){e=t=0;for(c of g)if(!n[c.s])t+=1+c.c,e++;f=i>>>8||i;if(b=1<f&&n.length)h=m[M[e-1]<<4|k<<3|(g.c>8*i)<<2|(i>2*e)<<1|g.s.length+h>2*i],h.s-=f=h.s>>>h.l,f+=!f;j=j/(t+f)>>>0,r=q/j>>>0;if(c=r<t){t=0;for(c of g)if(!n[c.s]&&r<(t+=f=1+c.c))break;t-=f}}else{c=g[0],f=p[r=c.c<<4|M[g.s.length-1]];j>>>=14,e=16384-f;if(q/j>>>0<f){t=0,p[r]+=e>>>6}else{c=0,p[r]-=f>>>6,t=f,f=e}}q-=j*t;if(c){if(b)k=0,h.l>6||--h.c||(h.s*=2,h.c=3<<h.l++);u[o++]=b=c.s;d=c;g.c+=2;if((c.c+=2)>>>8){r=t=0;for(c of g)if(t+=e=c.c>>>=1,e&&g.s)g[r++]=c;g.c=t+=g.length=r||i}if(c=g==v){g=v=d.l}else{for(i+=g.c;g!=v;v=v.s)t=v.c+v.length,e=2*f*(6+t),t+=i,e=e>6*t?2+e/t/2:e/t/1.6,v.c+=e=e>6?6:e,n[c++]=v[v.length]={s:b,c:0|e};for(v=d.l?g=d.l:(d=d.l=[],d.c=0,d.s=v,v=d);--c;d=d.l=[],d.c=0,d.s=v,v=d)d=n[c];n[c].l=v}n=[]}else{if(b)k=1,h.s+=t+f;for(c of g)n[c.s]=1;for(h=i;i==g.length;)if(!(g=g.s))return u}}}
];
//////////////// GUI ////////////////
(function(a){
	var F=[],hit="\0";
	a.wait0=function(fn){
		F[F.length]=fn;
		a.postMessage(hit,"*")
	};
	a.onmessage=function(e){
		if(e.source===a&&e.data===hit)
			e.stopPropagation(),
			F[0]&&F.shift()()
	}
})(this);
(function(g){
	const of=g("oform"),uf=g("uform"),info=g("res"),ol=g("flist");
	ol.ondrop=uf.upfile.onchange=function(e){
		ol.className="dpass";
		function rate(a,z){sum+=a-rate.a;rate.a=a;info.value=(a/z*1e4|0)/100+"%";info.style.width=(sum/fs*1e4|0)/100+"%"}
		function done(O,a,z){rate(a,a);
			var b=f[f.p].e;
			b.className="done";
			b.lastChild.value=O?a+' to '+z+' in '+(new Date-fr.st)+'ms':"Error";
			if(O)i+=z,b.firstChild.href=URL.createObjectURL(new Blob([O.buffer||new Uint8Array(O)]));
			else fs-=z;
			++f.p<f.length?fr.readAsArrayBuffer(f[f.p]):info.value+=", "+fs+" to "+i+"("+(i/fs*1e4|0)/100+"%)"+", "+(new Date-e)+"ms";uf.upfile.value=""
		}
		var f=(e.dataTransfer||e.target).files,i=f.p=0,n,r,sum=0,fs=0,fr=new FileReader,dc=uf.fdec.checked,ppm=(dc?PPMd:PPMe)[type.selectedIndex],mo=order.value&63;
		fr.onload=function(a){
			fr.st=new Date;a=new Uint8Array(fr.result);rate.a=0;
			dc?ppm(a,done,rate):ppm(a,mo,done,rate)
		}
		for(e.preventDefault(e.stopPropagation());e=f[i++];fs+=e.size)
			e.e=r=document.createElement("li"),n=e.name,
			r.innerHTML='<a download="'+n+'.out">'+n+'</a> <input type=button>',
			ol.appendChild(r);
		i=0;e=new Date;fr.readAsArrayBuffer(f[f.p])
	};
	ol.onclick=function(e){e=e.target||e.srcElement;e.nodeName=="INPUT"&&e.type=="button"&&confirm("remove?")?e.parentNode.outerHTML="":0};
	ol.ondragover=function(e){this.className="dover";e.preventDefault();e.dataTransfer.dropEffect='copy'};
	ol.ondragleave=function(){this.className="dpass"};
	g("kill").onclick=function(){
		info.value="ready..";
		uf.upfile.value=ol.innerHTML=""
	};
	g("save").onclick=function(){
		for(var a=ol.getElementsByTagName("a"),c=0,d;d=a[c++];)d.click();
		if(c<2)a=this,a.innerText="miss",setTimeout(function(){a.innerText="Save"},500)
	};
	of.onclick=function(e,n){
		e=e.target||e.srcElement;
		if(e.nodeName=="INPUT")n=e.type,n!="text"&&n!="number"||(e.value="")
	};
	for(let c of of.getElementsByTagName("input"))c.type!="text"||(c.onblur=function(){this.value||(this.value=this.defaultValue)});

// process for textarea
	const toCode=["EU16","EU16A","SJU","U8"],toBase=[64,85,91,122,32768],
		rate=(a,z)=>g("res").style.width=g("res").value=(a/z*1e4|0)/100+"%",
		done=(O,a,z)=>rate(1,1);

	g("en").onclick=async function(){
		var i=op.selectedIndex,a=CharCoder["e"+toCode[ip.selectedIndex]](it.value),
			b=await PPMe[type.selectedIndex](a,order.value,done,rate),
			c=ot.value=i<5?Base["e"+toBase[i]](b):i<6?b+"":dec2hex(b),d=b.length;
		d=i<3||i>4?d:i<4?u8s(c):d*2;
		res.value=a.length+" -> "+d
	}
	g("de").onclick=async function(){
		var i=op.selectedIndex,a=ot.value,b,c=a.length;
		if(i<3&&/[^\1-\x7f]/.test(a))return res.value="bad string";
		if(/[\u3400-\uC1FF]/.test(a))i=4;
		c=i<3||i>4?c:i<4?u8s(a):c*2;
		b=i<5?Base["d"+toBase[i]](a):i<6?str2dec(a):hex2dec(a);
		it.value=CharCoder["d"+toCode[ip.selectedIndex]](a=await PPMd[type.selectedIndex](b,done,rate));
		res.value=c+" -> "+b.length+" -> "+a.length
	}
})(a=>document.getElementById(a));
//////////////// binary to ascii ///////////////////
if(!this.Base){
const S=String.fromCharCode, n2cjk=n=>S(n+=n<6400?13312:n<27136?13568:16896);
this.Base={
e64(A){
	var a=62,b=0,c,z=A.length,B=new Uint8Array((z*4+2)/3),C=new Uint8Array(64);
	for(C[a]=43;a;)C[--a]=a>51?a-4:a>25?a+71:a+65;
	for(C[63]=47;a<z;B[b++]=C[63&c])c=A[a++]<<16|A[a++]<<8|A[a++],B[b++]=C[c>>18],B[b++]=C[63&c>>12],B[b++]=C[63&c>>6];
	return new TextDecoder().decode(B)
},
d64(A){
	if(typeof A=="string")A=new TextEncoder().encode(A);
	var a=62,b=0,c,z=A.length,B=new Uint8Array((z+2>>>2)*3-"0021"[z&3]),C=new Uint8Array(123);
	for(C[43]=a;C[--a>51?a-4:a>25?a+71:a+65]=a;);
	for(C[47]=63;a<z;B[b++]=255&c)c=C[A[a++]]<<18|C[A[a++]]<<12|C[A[a++]]<<6|C[A[a++]],B[b++]=c>>16,B[b++]=255&c>>8;
	return B
},
e85(B){
	var a=85,b,i,o=0,z=B.length,C=new Uint8Array(124),A=new Uint8Array((z*5+3)/4);
	for(;a;)C[--a]=a+38;
	for(C[54]=33;a<z;){
		b=(B[a++]|B[a++]<<8|B[a++]<<16|B[a++]<<24)>>>0;
		for(i=5;i--;b=b/85|0)A[o++]=C[b%85]
	}
	return new TextDecoder().decode(A)
},
d85(A){
	if(typeof A=="string")A=new TextEncoder().encode(A);
	var a=85,o=0,z=A.length,b=z%5,C=new Uint8Array(124),B=new Uint8Array((z-b)/5*4+(b&&b-1));
	for(;C[--a+38]=a;);
	for(C[33]=54,C[0..a]=0;a<z;B[o++]=b>>>24)
		b=52200625*C[A[a+=4]]+614125*C[A[a-1]]+7225*C[A[a-2]]+85*C[A[a-3]]+C[A[a++-4]],
		B[o++]=b,B[o++]=b>>8,B[o++]=b>>16;
	return B
},
e91(B){
	var a=91,b=0,c,z=B.length,n,o=0,A=new Uint8Array(z*1.24+2),C=new Uint8Array(a);
	for(;a;)C[--a]=(a>57)+!!a+a+33;
	for(;a<z;){
		c|=B[a++]<<b;b+=8;
		if(b>13){n=c&8191;
			if(n>88)c>>=13,b-=13;
			else n=c&16383,c>>=14,b-=14;
			A[o++]=C[n%91];A[o++]=C[n/91|0]
		}
	}
	if(b){
		A[o++]=C[c%91];
		if(b>7||c>90)A[o++]=C[c/91|0]
	}
	return new TextDecoder().decode(A.subarray(0,o))
},
d91(A){
	if(typeof A=="string")A=new TextEncoder().encode(A);
	for(var a=91,b=0,c=-1,d,e,o=0,C=new Uint8Array(126);C[(--a>57)+!!a+a+33]=a;);
	for(;d=A[a++];)
		if(d=C[d],~c)for(c+=d*91,e|=c<<b,b+=(c&8191)>88?13:14,c=-1;A[o++]=e&255,e>>=8,b-=8,b>7;);
		else c=d;
	if(~c)A[o++]=e|c<<b;
	return A.subarray(0,o)
},
e122(A){
	function g(c){
		if(a>=z)return-1;
		c=(254>>>b&A[a])<<b;c>>=1,b+=7;
		if(b<8||(b-=8,++a>=z))return c;
		return(65280>>b&A[a])>>8-b|c
	}
	var a=0,b=0,c,e=8,n,o=0,z=A.length,E=new Int8Array(256),B=new Uint8Array(z*1.15+3);
	for(n of[0,10,13,34,38,92])E[n]=e++;
	for(;c=g(),~c;B[o++]=c)
		if(e=E[c])n=g(),e=~n?194|28&e<<2:(n=c,222),B[o++]=e|n>>6,c=128|63&n;
	return new TextDecoder().decode(B.subarray(0,o))
},
d122(B){
	function p(n){n<<=1,c|=n>>b,b+=7;if(b>7)A[o++]=c,b-=8,c=n<<7-b&255}
	for(var a=0,b=0,c,d,e,o=0,z=B.length,E=[0,10,13,34,38,92],A=new Uint8Array(z*1.75);a<z;p(e))
		if(e=B.charCodeAt(a++),127<e)
			d=e>>8&7,7>d&&p(E[d]),e&=127;
	return A.subarray(0,o)
},
e32768(A){
	for(var a=0,b,c,i=0,n=0,z=A.length,s=[];a<z;)
		if(c=A[a++],n<8)b|=c<<7-n,n+=8;
		else n-=7,s[i++]=n2cjk(b|=c>>n),b=c<<15-n&32767;
	if(0<n)if(s[i++]=n2cjk(b),8<n)s[i++]=n2cjk(32768);
	return s.join("")
},
d32768(s){
	if(!s)return new Uint8Array(0);
	var a=0,b,c,i=0,n=s.length-1,z=15*(n>>3)+n%8*2,A=s[n]==n2cjk(32768);
	n%8<1&&!A&&z++,n%8&&A&&z--;
	A=new Uint8Array(z);
	for(n=0;a<z;n-=8,A[a++]=b>>n&255)
		if(n<8)c=s.charCodeAt(i++),b=b<<15|(c-=c<19712?13312:c<40704?13568:16896),n+=15;
	return A
}}}

//////////////// unicode converter ///////////////////
if(!this.CharCoder)this.CharCoder={
eEU16(S){
	for(var a=0,b=0,c,d,k=128,n,z=S.length,A=[];a<z;A[b++]=d){
		c=S.charCodeAt(a++);d=c&127;n=c>>7;
		if(c<256){
			if(k!=(n|=128))k=A[b++]=n
		}else if(c<0x3100&&c>0x2FFF){
			if(k!=(n+=34))k=A[b++]=n
		}else if(c>0xFEFF){
			if(k!=(n-=378))k=A[b++]=n
		}else if(c<0x2680&&c>0x20FF){
			if(k!=(n+=70))k=A[b++]=n
		}else if(c>0x047F||c<0x0380){
			if(k!=(n=(c-(c%=19968))/19968+147))k=A[b++]=n;
			A[b++]=(c-(d=c%156))/156
		}else if(k!=(n+=127))k=A[b++]=n
	}return A
},
dEU16(A){
	var a=0,b=0,c,d=0,e=1,z=A.length,B=[];
	for(;a<z;c<128?B[b++]=d+(e?c:c*156+A[a++]):d=(c&=e=31)<2?c<<7:c<4?c+94<<7:c>18?(e=0,c-19)*19968:c<6?c+506<<7:c<8?c+1<<7:c+58<<7)c=A[a++];
	B.length=b;return CharCoder.by(B)
},
eEU16A(S){
	for(var a=0,b=0,c,d,k=128,n,z=S.length,A=[];a<z;A[b++]=d){
		c=S.charCodeAt(a++);d=c&127;n=c>>7;
		if(c<256){
			if(k!=(n|=128))k=A[b++]=n
		}else if(c<0x3100&&c>0x2FFF){
			if(k!=(n+=34))k=A[b++]=n
		}else if(c>0x4DFF&&c<0xA010)
			c-=19968,A[b++]=((c-(c%=208))/208)+151,d=c+32;
		else if(c>0xFEFF){
			if(k!=(n-=378))k=A[b++]=n
		}else if(c<0x2680&&c>0x20FF){
			if(k!=(n+=70))k=A[b++]=n
		}else if(c>0x047F||c<0x0380){
			if(k!=(n=(c-(c%=19968))/19968+147))k=A[b++]=n;
			A[b++]=(c-(d=c%156))/156
		}else if(k!=(n+=127))k=A[b++]=n
	}return A
},
dEU16A(A){
	var a=0,b=0,c,d=0,e=1,z=A.length,B=[];
	for(;a<z;c<128?B[b++]=d+(e?c:c*156+A[a++]):c>150?B[b++]=(c-151)*208+A[a++]+19936:d=(c&=e=31)<2?c<<7:c<4?c+94<<7:c>18?(e=0,c-19)*19968:c<6?c+506<<7:c<8?c+1<<7:c+58<<7)c=A[a++];
	B.length=b;return CharCoder.by(B)
},
eSJU(S,n){
	if((n&=255)<32||n>64)n=64;
	var a=0,b=0,c,m=252-n,p=127-n,z=S.length,A=[];
	for(;a<z;A[b++]=c&255)
		if((c=S.charCodeAt(a++))>127)
			if(c<0x3100&&c>0x2FFF)A[b++]=128;
			else if(c>0x4DFF&&c<0xA040)A[b++]=(((c-=19968)-(c%=m))/m)+129,c+=c<p?n:n+1;
			else if(c>0xFEFF)A[b++]=241;
			else if(c>0x1FFF&&c<0x2700)A[b++]=(c>>8)+210;
			else if(c<0x500&&c>0x2FF)A[b++]=(c>>8)+249;
			else A[b++]=251,A[b++]=c>>8;
	return A
},
dSJU(A,n){
	if((n&=255)<32||n>64)n=64;
	var a=0,b=0,c,m=252-n,z=A.length,B=[];
	for(;a<z;)c=A[a++],
		B[b++]=c<128?c
		:c<129?12288|A[a++]
		:c<241?(c-129)*m+(c=A[a++])-(c<127?n:n+1)+19968
		:c<242?65280|A[a++]
		:c<249?c-210<<8|A[a++]
		:c<251?c-249<<8|A[a++]
		:A[a++]<<8|A[a++];
	B.length=b;
	return CharCoder.by(B)
},
eU8(S){// utf8 encoding
	if(self.TextEncoder)return new TextEncoder().encode(S);
	var a=0,b,A=new Uint8Array(S.length*4);
	for(b of S){
		b=b.codePointAt();
		if(b>127){
			if(b<2048)A[a++]=b>>6|192;
			else{
				if(b<65536)A[a++]=b>>12|224;
				else A[a++]=b>>18|240,A[a++]=b>>12&63|128;
				A[a++]=b>>6&63|128
			}b=b&63|128
		}A[a++]=b
	}return new Uint8Array(A.buffer,0,a)
},
dU8(A){// utf8 decoding
	if(self.TextDecoder)return new TextDecoder().decode(A);
	var a=0,b=0,c,z=A.length,B=[],S=String.fromCodePoint;
	if(S)for(;a<z;B[b++]=c<128?c:c<224?(c&31)<<6|A[a++]&63:c<240?(c&15)<<12|(A[a++]&63)<<6|A[a++]&63:(c&7)<<18|(A[a++]&63)<<12|(A[a++]&63)<<6|A[a++]&63)c=A[a++];
	else for(S=String.fromCharCode;a<z;)
		if((c=A[a++])<240)
			B[b++]=c<128?c:c<224?(c&31)<<6|A[a++]&63:(c&15)<<12|(A[a++]&63)<<6|A[a++]&63;
		else c=((c&7)<<18|(A[a++]&63)<<12|(A[a++]&63)<<6|A[a++]&63)-65536,
			B[b++]=0xd800|c>>10,B[b++]=0xdc00|c&0x3ff;
	if(z<65565)return S.apply(0,B);
	for(a=0,b="",z=65536;A=B.slice(a,a+=z),z=A.length;)b+=S.apply(0,A);
	return b
},
by(A){
	var a=A.length,S=String.fromCharCode;
	if(a<65536)S.apply(0,A);
	let b=0,B,C="";
	for(a=65536;B=A.slice(b,b+=a),a=B.length;)C+=S.apply(0,B);
	return C
}}

///////////////////////////////////
function hex2dec(s){
	for(var i=256,a=[],c;i;a[c=(i>15?"":0)+i.toString(16)]=a[c.toUpperCase()]=i)if(--i<16)a[c=i.toString(16)]=a[c.toUpperCase()]=i;
	for(s=s.match(/[\dA-Fa-f]{1,2}/g)||[],i=s.length;i;)s[--i]=a[s[i]];
	return s
}
function dec2hex(s){
	for(var i=256,a=Array(i),b=s instanceof Array?s:[];i;)a[--i]=(i>15?"":0)+i.toString(16);
	for(i=s.length;i;)b[--i]=a[s[i]];return b.join(" ")
}
function str2dec(s){
	s=s.match(/\d+/g)||[];
	for(var i=s.length;i;)s[--i]>>>=0;
	return s||[]
}
function u8s(s){return s.replace(/[\x80-\u07FF]/g,11).replace(/[\u0800-\uFFFF]/g,111).length}
</script>
